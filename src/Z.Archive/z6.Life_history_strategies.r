#/*##########################################################################*/
#' Import Life History data
#' ==========================================================================
#'
#' by Mark R Payne  
#' DTU-Aqua, Charlottenlund, Denmark  
#' http://www.staff.dtu.dk/mpay  
#'
#' Tue Jul 18 08:39:44 2017
#'
#' Imports Laurene's life history strategies 
#
#  This work is subject to a Creative Commons "Attribution" "ShareALike" License.
#  You are largely free to do what you like with it, so long as you "attribute" 
#  me for my contribution. See the fine print at the end for exact details.
#
#  To do:
#    * Can probably refine the FAO code and LHS species match ups a bit better so that 
#      we get full matching. It particularl seems that genuses are a problem.  
#
#  Notes:
# - While this script contains reminants of RMarkdown, it is not in a state
#    where it can be compiled in a meaningful manner
#/*##########################################################################*/

#/*======================================================================*/
#  Initialise system
#/*======================================================================*/
cat(sprintf("\n%s\n","Import Life History Strategies"))
cat(sprintf("Analysis performed %s\n\n",base::date()))

#Configure markdown style, do house cleaning
rm(list = ls(all.names=TRUE));  graphics.off();
start.time <- proc.time()[3]; options(stringsAsFactors=FALSE)

#Helper functions, externals and libraries
log.msg <- function(fmt,...) {cat(sprintf(fmt,...));
                              flush.console();return(invisible(NULL))}

library(tidyverse)

#/*======================================================================*/
#  Setup
#/*======================================================================*/
#Load data
LHS.dat.raw <- read.csv2("data/Laurene_LHS/Species LHS.csv")
load("objects/ICES_data.RData")

#Merge FAO species codes together with scientific names
LHS.dat <- merge(LHS.dat.raw,FAO.species.codes[],by.x="Species",by.y="Latin",all.x=TRUE)

#How many failed to merge
table(is.na(LHS.dat$FAO_code))

#Drop merge failues
LHS.dat <- subset(LHS.dat,!is.na(FAO_code))
LHS.dat <- as.tibble(LHS.dat)

#/*======================================================================*/
#  Complete
#/*======================================================================*/
#Save results
save(LHS.dat,file="objects/LHS_strategies.RData")

#Turn off thte lights
if(grepl("pdf|png|wmf",names(dev.cur()))) {dmp <- dev.off()}
log.msg("\nAnalysis complete in %.1fs at %s.\n",proc.time()[3]-start.time,base::date())

#' -----------
#' <small>*This work by Mark R Payne is licensed under a  Creative Commons
#' Attribution-NonCommercial-ShareAlike 3.0 Unported License. 
#' For details, see http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US
#' Basically, this means that you are free to "share" and "remix" for 
#' non-commerical purposes as you see fit, so long as you "attribute" me for my
#' contribution. Derivatives can be distributed under the same or 
#' similar license.*</small>
#'
#' <small>*This work comes with ABSOLUTELY NO WARRANTY or support.*</small>
#'
#' <small>*This work should also be considered as BEER-WARE. For details, see
#' http://en.wikipedia.org/wiki/Beerware*</small>
#' 
#' -----------
