#'========================================================================
# Shiny.app.r
#'========================================================================
#
# by Mark R Payne
# DTU-Aqua, Kgs. Lyngby, Denmark
# http://www.staff.dtu.dk/mpay
#
# Created Tue Oct  8 09:39:59 2019
#
# Shiny app for visualising the SIDS Predictability results 
#
# This work is subject to a Creative Commons "Attribution" "ShareALike" License.
# You are largely free to do what you like with it, so long as you "attribute"
# me for my contribution. See the fine print at the end for exact details.
#
# To do:
#
# Notes:
#
#'========================================================================

#'========================================================================
# Initialise ####
#'========================================================================
source(here::here("Helper_functions.r"))

#'========================================================================
# UI ####
#'========================================================================
# Title row -----------------------------------------------------------------------
ui.hdr <- 
  HTML('<table style="width:100%">
          <tr>
         <td valign="center"> 
           <img src="CERES_logo.png"  height=35px />
         </td> 
         <td valign="center" align="left"> 
           <h1>CERES Climate Risk Analysis </h1> 
         </td> 
         </table>')


# Storylines tab ------------------------------------------------------------------
#Storyline selection
storyline.choices <- seq(nrow(storylines))
names(storyline.choices) <- storylines$Name

sty.sel.box.ctrls <- list(radioButtons(inputId="sty.select",
                                       label="Select storyline",
                                       choices=storyline.choices,
                                       selected=1))
#Area selection
sty.sidebar.panel <- sidebarPanel(width=4,
                                  sty.sel.box.ctrls)

#Results panel
sty.main.panel <- mainPanel(h2(textOutput("sty.title")),
                            h3("Climate Risk to Fleets"),
                            plotOutput(outputId = "sty.fleet.risk"),
                            textOutput("sty.risk.txt"),
                            h3("Climate Hazard to Stocks"),
                            plotOutput(outputId = "sty.stock.hazard"),
                            h3("Species"),
                            tableOutput("sty.sel.sp.tbl"),
                            h3("FAO Subareas"),
                            plotOutput("sty.sel.area"))

# by Species Tab ------------------------------------------------------------------
sp.sel.box.ctrls <- list(radioButtons(inputId="sp.select.by",
                                      label="Select species by",
                                      choices=c("Scientific name"="sci",
                                                "Common Name"="common",
                                                "FAO Code"="FA03A"),
                                      selected="FAO Code"),
                         pickerInput(inputId = "sp.sel",
                                     multiple=TRUE,
                                     #selected=c("ALB","BFT"),
                                     choices = sci.names))

#Area selection
sp.sidebar.panel <- sidebarPanel(width=4,
                                 sp.sel.box.ctrls,
                                 HTML('<label class="control-label" for="sp.area.sel">Click to select FAO subarea</label>'),
                                 plotOutput("sp.area.sel",click="sp.area.sel.click",height="250px"),
                                 actionButton("sp.toggle.button","Toggle"),
                                 actionButton("sp.reset.button","Reset"))

#Results panel
sp.main.panel <- mainPanel(h3("Climate Risk to Fleets"),
                           plotOutput(outputId = "sp.fleet.risk"),
                           h3("Climate Hazard to Stocks"),
                           plotOutput(outputId = "sp.stock.hazard"),
                           h3("Selected species"),
                           tableOutput("sp.sel.sp.tbl"))


# Fleets tab ------------------------------------------------------------------
flt.sel.box.ctrls <- list(radioButtons(inputId="flt.select.by",
                                      label="Select species by",
                                      choices=c("Scientific name"="sci",
                                                "Common Name"="common",
                                                "FAO Code"="FA03A"),
                                      selected="FAO Code"),
                         pickerInput(inputId = "flt.sel",
                                     multiple=TRUE,
                                     #selected=c("ALB","BFT"),
                                     choices = sci.names))

#Area selection
flt.sidebar.panel <- sidebarPanel(width=4,
                                 sp.sel.box.ctrls,
                                 HTML('<label class="control-label" for="sp.area.sel">Click to select FAO subarea</label>'),
                                 plotOutput("flt.area.sel",click="flt.area.sel.click",height="250px"),
                                 actionButton("flt.toggle.button","Toggle"),
                                 actionButton("flt.reset.button","Reset"))

#Results panel
flt.main.panel <- mainPanel(h3("Climate Risk to Fleets"),
                           plotOutput(outputId = "flt.fleet.risk"),
                           h3("Climate Hazard to Stocks"),
                           plotOutput(outputId = "flt.stock.hazard"),
                           h3("Selected species"),
                           tableOutput("flt.sel.sp.tbl"))

# About Tab -----------------------------------------------------------------------
about.tab <- 
  HTML('<p>The source code for both this application and the associated analysis are stored under 
  version control on GitHub at 
  <a href="https://github.com/markpayneatwork/CERES_vulnerability" class="uri">https://github.com/markpayneatwork/CERES_vulnerability</a></p>

  <p>This work is licensed under the <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
  
  <p>This work has recevied funding from the European Unionâ€™s Horizon 2020 research and innovation programme under 
  grant agreement No 678193 (CERES, Climate Change and European Aquatic Resources).</p>

  <center>
    <img src="Logo_transparent.png" height="100px">
    <img src="flag_yellow_high-Kopie-300x200.jpg" height="100px")
  </center>')


# Bring it all together -----------------------------------------------------------
ui <- fluidPage(ui.hdr,
                tabsetPanel(tabPanel("Storylines", sidebarLayout(sty.sidebar.panel,sty.main.panel)),
                            tabPanel("by Species", sidebarLayout(sp.sidebar.panel,sp.main.panel)),
                            tabPanel("by Fleet", sidebarLayout(flt.sidebar.panel,flt.main.panel)),
                            tabPanel("About", about.tab),
                            selected="by Fleet"))

shinyUI(ui)

# .............
# This work by Mark R Payne is licensed under a  Creative Commons
# Attribution-NonCommercial-ShareAlike 3.0 Unported License.
# For details, see http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US
# Basically, this means that you are free to "share" and "remix" for
# non-commerical purposes as you see fit, so long as you "attribute" me for my
# contribution. Derivatives can be distributed under the same or
# similar license.
#
# This work comes with ABSOLUTELY NO WARRANTY or support.
#
# This work should also be considered as BEER-WARE. For details, see
# http://en.wikipedia.org/wiki/Beerware
# .............
