# Storylines

Some examples of how to present the results for use in the Storyline documents

## Example - Hake in the Mediterranean

```{r}
#Setup
library(tidyverse)
library(here)

#Import
sp.db <- readRDS(here("objects/species_database.rds"))
stk.haz <- readRDS(here("objects/biological_metrics/stock_hazard.rds"))
flt.haz <- readRDS(here("objects/fleet_metrics/Fleet_hazard.rds"))
flt.catch <- readRDS(here("objects/catch/STECF_catch_data.rds"))

#Setup species and area selections
sel.sp <- 
  sp.db %>%
  filter(grepl("Merluccius",Scientific_name) | grepl("[Hh]ake",FAO_EN))
sel.areas <- c("37.1","37.2","37.3","37.4")
storyline.name <- "Hake"

knitr::kable(
  sel.sp,
  caption="Selected Species "
)

```

### Species risk

```{r}
#Select stocks in these regions
stk.sel <-
  stk.haz %>%
  filter(F_CODE %in% sel.areas) %>%
  mutate(Stocks="All in region")
  
#Markthe species as interest
stk.sel %>%
  filter(FAO_3A_code %in%  sel.sp$FAO_3A_code) %>%
  mutate(Stocks=storyline.name) %>%
  bind_rows(stk.sel) %>%
  #Plot
  ggplot(aes(x=hazard,fill=Stocks))+
  geom_density(aes(y=..scaled..),colour=NA,alpha=0.75)+
  theme_void()+
  theme(axis.title=element_text(),axis.title.x=element_text())+
  labs(x="Climate Hazard",y="")

```
Example of how a stock hazard might look

## Fleet hazard

```{r}
#Get fleets that fish on this species, in this area
flts.in.area <- 
  flt.catch %>%
  filter(F_SUBAREA %in% sel.areas)
flts.catching.sp <- 
  flts.in.area %>%
  filter(species_code %in% sel.sp$FAO_3A_code)

#Now prepare hazard data
sel.flt.haz <-
  flt.haz %>%
  filter(fs_name %in% flts.in.area$fs_name) %>%
  mutate(Fleets="All in region")

sel.flt.haz %>%
  filter(fs_name %in% flts.catching.sp$fs_name) %>%
  mutate(Fleets="Catching Hake") %>%
  bind_rows(sel.flt.haz) %>%
  #Plot
  ggplot(aes(x=hazard,fill=Fleets))+
  geom_density(aes(y=..scaled..),colour=NA,alpha=0.75)+
  theme_void()+
  theme(axis.title=element_text(),axis.title.x=element_text())+
  labs(x="Climate Hazard",y="")

```

