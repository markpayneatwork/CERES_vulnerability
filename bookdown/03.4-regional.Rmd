## Regional Metrics

### Regional hazard

```{r}
#Import data
reg.hazard <- readRDS(here("objects/regional_metrics/regional_hazard.rds"))
reg.poly <- readRDS(here("objects/Geodata/region.polys.rds"))

#Merge
left_join(reg.poly,reg.hazard,by="region") %>%
  ggplot()+
  bg.map+
  geom_sf(aes(fill=hazard))+
  labs(fill="Hazard\nscore")

```


### Regional exposure

Similar relationships between the catch dominance and catch diversity are seen at the regional levels as are seen for the fleets.

```{r}
#Import data
reg.exp <- readRDS(here("objects/regional_metrics/regional_exposure.rds"))

ggplot(reg.exp,aes(shannon.H,simpsons.D))+
  geom_point()+
  labs(x="Shannon Diversity (H)",y="Simpson's Dominance (D)")


```

Check on the scaling and tendency

```{r}
reg.exp %>%
  gather("parameter","value",-region,-exposure) %>%
  filter(parameter %in% c("shannon.H","simpsons.D")) %>%
ggplot(aes(x=value,y=exposure))+
  geom_point()+
  facet_wrap(~parameter,scale="free_x")
  
```


Plotting the exposure score geographically

```{r}
#Plot
right_join(reg.poly,reg.exp,by="region") %>%
ggplot()+
  bg.map+
  geom_sf(aes(fill=shannon.H))+
  labs(fill="Shannon H")

```

Note the clear north-south gradient here. Several countries are still missing from this analysis, as we don't have data resolved by NUTS regions for them (e.g. Norway, Finland, parts of Sweden, SE Europe). We need to find a strategy how to deal with this.

### Regional vulnerability

Currently this is only based on GDP per capita. Other metrics can be added. Plotting the distribution of values.

```{r}
#Import NUTS vulnerability metrics
reg.vul <- 
  readRDS(here("objects/regional_metrics/regional_vulnerability.rds")) 

ggplot(reg.vul,aes(x=gdp.percap))+
  stat_bin()

```

Checking the scaling and directionality

```{r}
reg.vul %>%
  gather("parameter","value",-region,-vulnerability) %>%
ggplot(aes(x=value,y=vulnerability))+
  geom_point()+
  facet_wrap(~parameter,scale="free_x")

```


Distribution map.

```{r}
reg.vul %>%
  right_join(x=reg.poly) %>%
  ggplot()+
  bg.map+
  geom_sf(aes(fill=gdp.percap),col=NA)+
  labs(fill="GDP per capita")+
  coord_sf(xlim=c(-20,30),ylim=c(30,70))
```


### Regional risk

We calculate risk as the average of the hazard, exposure and vulnerability scores. This may need to be improved. The top and bottom ten regions by risk are then

```{r}
reg.risk <- 
  readRDS(here("objects/regional_metrics/regional_risk.rds")) %>%
  arrange(risk)

knitr::kable(
  bind_rows(head(reg.risk,n=10),tail(reg.risk,n=10)),
  caption="Top and bottom 10 regions by risk",
  digits=3)

```

Putting it on a map

```{r}
reg.poly %>%
  right_join(y=reg.risk) %>%
  ggplot()+
  bg.map+
  geom_sf(aes(fill=risk))+
  labs(fill="Climate\nRisk")
```

Putting it up as a boxplot

```{r}
reg.risk %>%
  mutate(country=fct_reorder(country,risk)) %>%
ggplot(aes(y=risk,x=country))+
  stat_boxplot()+
  labs(x="Country (sorted by median)",y="Risk")
  
```


Interesting results. Lots of details there to discuss!

