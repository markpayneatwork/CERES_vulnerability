# Archive

Analyses and text that are currently not being used, but that are included here for reference

## Stock-specific warming rate

```{r}
library(tidyverse)
library(sf)
library(here)

#Setup Aquamaps ------------------------------------------------------
#Note that the selection of species is done in script C3, to avoid having to load all of the
#aquamaps here
this.amap <-
  readRDS(here("objects/Aquamaps/selected_map.rds")) %>%
  filter(!is.na(F_CODE)) #Restract to focus regions
this.misc <- readRDS(here("objects/Aquamaps/selected_metrics.rds"))
FAO.regions <- readRDS(here("objects/Geodata/FAO_polygons.rds"))
FAO.focus <- "27.4"
```

The Aquamaps environmental database also contains temperature projections, based on the IPSL model under IPCC scenario A2. We can use this to calculate the rate of warming for each pixel within the habitat of cod over the period (1999-2050).

```{r fig.cap=paste("Average rate of warming derived from Aquamaps")}

this.FAO.amap <- this.amap %>%
  filter(F_CODE==FAO.focus) 

scale.fn <- function(x) {
  c(-max(abs(x)),max(abs(x)))
}
ggplot()+
  geom_raster(data=this.amap,mapping=aes(Center.Long,Center.Lat,fill=this.warm.rate))+
  geom_sf(data=FAO.regions,fill=NA)+
  annotation_map(map_data("world"),fill="black")+
  geom_sf_text(data=FAO.regions,aes(label=F_CODE),colour="blue")+
  coord_sf(ylim=c(40,90))+
  labs(x="",y="",fill="Warming (deg C/yr)")+
  scale_fill_distiller(palette="RdBu",limits=scale.fn)

```

This clearly shows that not all areas are warming, or equally.

```{r fig.cap=paste("Distribution of warming rate values for FAO region",FAO.focus," The dashed vertical line indicates the median value.")}
ggplot(this.FAO.amap,aes(x=this.warm.rate))+
  stat_bin()+
  geom_vline(xintercept=median(this.FAO.amap$this.warm.rate),linetype=2)+
  labs(x="Warming rate (deg C / yr)",y="Number of pixels")
```

Now, we can repeat the exercise for all FAO areas for this species, and plot the two median values of the metrics against each other.

```{r}
ggplot(this.misc$metrics,aes(x=median.TSM,y=median.warm.rate))+
  geom_point()+
  geom_hline(yintercept = 0)  +
  geom_text(aes(label=F_CODE),vjust=-1)+
  labs(x="TSM (deg C)",y="Warming rate (deg C / yr)")
```

This figure could forms the basis for defining  exposure and sensitivity metrics for `r this.misc$meta$common.name`. The region with the highest vulnerability is that in the top-left i.e. where the TSM is low and the warming rate is high. Regions with negative warming rates are essentially cooling and therefore should have the lowest vulnerability score.

However, John and I have also had a long discussion about this, and decided in the end to leave the spatial context of warmnig out ot the analysis, as 

* we are unsure how to incorporate it into the climate-risk framework 
* we are not particularly happy with the Aquamaps warming projections - they are fairly old and based on a single model - some of the results projecting cooling in this model are not consistent with out understanding. To do this properly we would need to consider either a multi-model ensemble, preferably with downscaling to capture the shelf effects and the baltic properly

Instead, we choose to say that everything is captured by the TSM.

## Relative TSM

As an aside, I also considered defining a relative TSM, by normalising the TSM by the rate of warming. i.e.

$$RTSM_i=\frac{T_{90^{th}}-T_{i}}{r_{warm}}$$
where $r_{warm}$ is the rate of warming, in degrees C per year - RTSM therefore has units of years, and could be interpreted as the number of years until the TSM was exceeded. However, although this seemed like a good idea at the time, it didn't really workout in practice very well - the negative and zero warming rates lead to many RTSMs that were extremely large.


