## Biological Aspects
```{r echo=FALSE}
#Setup --------------------------------------
library(tidyverse)
library(here)
library(sf)
bucket.categories <- read_csv2(here("data/Taxonomic_issues/bucket_categories.csv"))
trait.db <- readRDS(here("objects/trait_database.rds"))
manja.dat <- read_csv2(here("data/Traits/Manja/compare metrics.csv"))
alt.names <- read_csv2(here("data/Taxonomic_issues/alternative_names.csv"),comment="#")
amaps.meta <- readRDS(here("objects/Aquamaps/Aquamaps_meta.rds"))


```


### Selection of Species

* Initially screen EUROSTAT data and select species that cover 90% of landings by value, both at the European wide level and on a country-by-country basis. 

With the exception of Caproidae (boarfish, which is dominated by the species *Capros aper*, entries that were not taxnomically resolved to either species or genus level were removed from the analysis, as it was deemed to be too difficult to extract representative biological information at such a coarse level.

The initial species list contained `r sum(trait.db$n.xx.in.TAXOCODE==2,na.rm=TRUE)` entries that were only taxonomically resolved to the Genius level (so-called "bucket categories"). For the purpose of defining traits and further analysis, exemplar species were chosen to represent this group. In some cases, it was necessary to use different exemplars for the North Atlantic (FAO 27) and Mediterranean regions (FAO 34). 

Furthermore, two species that are predominately freshwater, European perch (*Perca fluviatilis* FAO code FPE) and Pike-perch (*Sander lucioperca* FAO code FPP) were also removed from the database. Two further groups, Barnacles (*Pollicipes pollicipes* FAO code PCB) and Solen razor clams (*Solen spp* FAO code RAZ) were also removed, as it was not possible to find appropriate Aquamaps or identify suitable exemplars.

The initial selection  covered `r nrow(manja.dat)` fish and shellfish groups. Of these, the following `r sum(manja.dat$n.xx.in.TAXOCODE>2,na.rm=TRUE)` groups were only resolved at a taxonomic level higher than Genus, and were therefore removed from the analysis.

```{r}
knitr::kable(
  filter(manja.dat,n.xx.in.TAXOCODE>2) %>%
    select(FAO_3A_code,ISSCAAP,TAXOCODE,Scientific_name,FAO_EN),
  booktabs = TRUE,
  caption = 'Groups resolved at a taxonomic level higher than Genus.'
)

```

A further `r sum(manja.dat$n.xx.in.TAXOCODE==2,na.rm=TRUE)` groups were only resolved at the Genus species, and were replaced with the following exemplar species in each area.

```{r}
knitr::kable(
  bucket.categories,
  booktabs = TRUE,
  caption = 'Groups resolved as the Genus level, and associated selection of exemplar species in FAO regions 27 and 37.'
)

```

Alternative (and misspelled) scientific names were also a problem in many cases. This is the list of modifications made

```{r}
knitr::kable(
  select(alt.names,FAO_3A_code,Scientific_name,FAO_EN,Alt.sci.name),
  booktabs = TRUE,
  caption = 'Alternative scientific names'
)
```






### Adaptive capacity  - biological traits

### Scoring method

The conversion from traits to a habitat score is done using the following code:

```{r comment=NA}
library(here)
l <- readLines(here("src/B.Species_selection/B2.Species_selection_and_traits.r"))
hab.scoring.start <- grep("Habitat scoring",l)
blank.lines <- which(l=="")
next.blank <- blank.lines[which(blank.lines > hab.scoring.start)[1]]
cat(l[hab.scoring.start:next.blank],sep="\n")

```

