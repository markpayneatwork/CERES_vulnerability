---
title: "Comparison with Manja's final traits"
output:
  html_document: 
    df_print: paged
    keep_md: no
    toc: yes
    toc_float: yes
---

```{r setup, include="FALSE"}
#'========================================================================
# Comparison with Manja's final traits
#'========================================================================
#
# by Mark R Payne
# DTU-Aqua, Kgs. Lyngby, Denmark
# http://www.staff.dtu.dk/mpay
#
# Created Tue Aug 20 14:18:02 2019
#
# <Description>
#
# This work is subject to a Creative Commons "Attribution" "ShareALike" License.
# You are largely free to do what you like with it, so long as you "attribute"
# me for my contribution. See the fine print at the end for exact details.
#
# To do:
#
# Notes:
#   * Knitting of notebooks from Rstudio leads to all sorts of messy problems 
#     with the directory. Use here::here() to specify a location relative to
#     the project top directory
#
#'========================================================================

#Configure Knitr
knitr::opts_chunk$set(
  echo=TRUE,
	error = FALSE,
	message = FALSE,
	warning = FALSE,
	include = TRUE,
	results = "markup",
	fig.width = 10,
	fig.height=14/25*10,
  fig.align="center",
  fig.path=here::here("notebooks","figures","Comparison with Manja's final traits_"))

#Powerpoint needs 14 x 25cm figures

# knitr::opts_knit$set(
#    root.dir="..")

library(tidyverse)
library(ggplot2)
library(tibble)
library(here)

theme_set(theme_bw(base_size = 14))
```

by Mark R Payne  <br>
DTU-Aqua, Kgs. Lyngby, Denmark  <br>
http://www.staff.dtu.dk/mpay  <br>
`r format(Sys.time(), "%a %b %d %Y, %H:%M:%S ")`

This notebook does a comparison between the implementation of the trait database here and the final versiono that Manja produced.


```{r echo=FALSE}
#'========================================================================
# Setup ####
#'========================================================================
#Import data
this.db <- readRDS(here("objects/Species_database.rds"))
manja.dat <- read_csv2(here("data/Traits/Manja/Species vulnerability with new RTSM_new.csv"))

```


## Habitat scores

Show only the mismatch between the scores
```{r}
# Subset down to data of interest
mismatch.scores <- 
  full_join(rename(this.db,this.score=hab.score),
            select(manja.dat,FAO_3A_code,manja.score=score.hab),
            by="FAO_3A_code") %>%
  filter(manja.score!=this.score | is.na(manja.score) | is.na(this.score)) %>%
  select(FAO_3A_code,FAO_EN,horizontal.habitat,vertical.habitat,Mobility,this.score,manja.score)

mismatch.scores
```


## Lifespans

```{r}
full_join(rename(this.db,Mark.val=Lifespan.n),
            select(manja.dat,FAO_3A_code,Manja.val=Lifespan.n),
            by="FAO_3A_code") %>%
  filter(Manja.val!=Mark.val | is.na(Manja.val) | is.na(Mark.val)) %>%
  select(FAO_3A_code,FAO_EN,Mark.val,Manja.val)

```

## Lifespan scores

```{r}
full_join(rename(this.db,Mark.val=ls.score),
          select(manja.dat,FAO_3A_code,Manja.val=ls_score,Lifespan.n),
          by="FAO_3A_code",
          suffix=c(".Mark",".Manja")) %>%
  filter(Manja.val!=Mark.val | is.na(Manja.val) | is.na(Mark.val)) %>%
  select(FAO_3A_code,FAO_EN,Mark.val,Manja.val,starts_with("Lifespan.n"))

```


***
*This work by Mark R Payne is licensed under a  Creative Commons
Attribution-NonCommercial-ShareAlike 3.0 Unported License. 
For details, see http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US
Basically, this means that you are free to "share" and "remix" for 
non-commerical purposes as you see fit, so long as you "attribute" me for my
contribution. Derivatives can be distributed under the same or 
similar license.*

*This work comes with ABSOLUTELY NO WARRANTY or support.*

***



